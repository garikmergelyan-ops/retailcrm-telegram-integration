# –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞ (Traceroute) - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## –ß—Ç–æ —Ç–∞–∫–æ–µ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞?

**Traceroute** (—Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞) - —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- **–ü—É—Ç—å –ø–∞–∫–µ—Ç–æ–≤** –æ—Ç –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ —Ü–µ–ª–µ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- **–ó–∞–¥–µ—Ä–∂–∫–∏ (latency)** –Ω–∞ –∫–∞–∂–¥–æ–º —É–∑–ª–µ (hop) –≤ –ø—É—Ç–∏
- **–ì–¥–µ –∏–º–µ–Ω–Ω–æ** –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –∏–ª–∏ –ø–æ—Ç–µ—Ä–∏ –ø–∞–∫–µ—Ç–æ–≤

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞–∫–µ—Ç—ã —Å —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–∏–º—Å—è TTL (Time To Live)
2. –ö–∞–∂–¥—ã–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –≤ –ø—É—Ç–∏ —É–º–µ–Ω—å—à–∞–µ—Ç TTL –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É
3. –ü–æ —ç—Ç–∏–º –æ—à–∏–±–∫–∞–º —Å—Ç—Ä–æ–∏—Ç—Å—è –∫–∞—Ä—Ç–∞ –ø—É—Ç–∏

### –ß—Ç–æ –º—ã —É–∑–Ω–∞–µ–º:
- –°–∫–æ–ª—å–∫–æ —É–∑–ª–æ–≤ –º–µ–∂–¥—É –Ω–∞–º–∏ –∏ RetailCRM
- –ó–∞–¥–µ—Ä–∂–∫–∏ –Ω–∞ –∫–∞–∂–¥–æ–º —É–∑–ª–µ
- –ì–¥–µ –∏–º–µ–Ω–Ω–æ —Ç–µ—Ä—è—é—Ç—Å—è –ø–∞–∫–µ—Ç—ã –∏–ª–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –∑–∞–¥–µ—Ä–∂–∫–∏
- –ü—Ä–æ–±–ª–µ–º—ã —Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π

---

## –ö–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É —Å Render.com

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Node.js —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–°–æ–∑–¥–∞–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏:

```javascript
// traceroute-test.js
const { exec } = require('child_process');
const util = require('util');
const execPromise = util.promisify(exec);

async function runTraceroute(hostname) {
    try {
        console.log(`üîç –í—ã–ø–æ–ª–Ω—è—é —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É –¥–æ ${hostname}...\n`);
        
        // –î–ª—è Linux/Unix —Å–∏—Å—Ç–µ–º (Render.com –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Linux)
        const { stdout, stderr } = await execPromise(`traceroute -n -m 30 ${hostname}`, {
            timeout: 60000 // 60 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç
        });
        
        if (stderr) {
            console.error('‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:', stderr);
        }
        
        console.log('üìä –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏:');
        console.log(stdout);
        
        return stdout;
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏:', error.message);
        
        // –ü–æ–ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ —á–µ—Ä–µ–∑ ping
        try {
            console.log('\nüîÑ –ü—Ä–æ–±—É—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ —á–µ—Ä–µ–∑ ping...');
            const { stdout } = await execPromise(`ping -c 10 ${hostname}`);
            console.log(stdout);
        } catch (pingError) {
            console.error('‚ùå Ping —Ç–æ–∂–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:', pingError.message);
        }
        
        throw error;
    }
}

// –í—ã–ø–æ–ª–Ω—è–µ–º —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É –¥–ª—è –æ–±–æ–∏—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
async function main() {
    const accounts = [
        'aff-gh.retailcrm.ru',
        'slimteapro-store.retailcrm.ru'
    ];
    
    for (const account of accounts) {
        console.log(`\n${'='.repeat(60)}`);
        console.log(`–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –¥–æ: ${account}`);
        console.log('='.repeat(60));
        
        try {
            await runTraceroute(account);
        } catch (error) {
            console.error(`–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É –¥–æ ${account}`);
        }
        
        // –ü–∞—É–∑–∞ –º–µ–∂–¥—É —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞–º–∏
        await new Promise(resolve => setTimeout(resolve, 2000));
    }
}

main().catch(console.error);
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –î–æ–±–∞–≤–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–µ—Ä–≤–µ—Ä

–î–æ–±–∞–≤—å—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ `smart-polling-server.js`:

```javascript
// –í—Ä–µ–º–µ–Ω–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ (—É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
app.get('/debug/traceroute', async (req, res) => {
    const { exec } = require('child_process');
    const util = require('util');
    const execPromise = util.promisify(exec);
    
    const hostname = req.query.host || 'aff-gh.retailcrm.ru';
    
    try {
        const { stdout, stderr } = await execPromise(`traceroute -n -m 30 ${hostname}`, {
            timeout: 60000
        });
        
        res.json({
            success: true,
            hostname: hostname,
            result: stdout,
            warnings: stderr || null
        });
    } catch (error) {
        res.status(500).json({
            success: false,
            error: error.message,
            hostname: hostname
        });
    }
});
```

–ó–∞—Ç–µ–º –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
- `https://your-app.onrender.com/debug/traceroute?host=aff-gh.retailcrm.ru`
- `https://your-app.onrender.com/debug/traceroute?host=slimteapro-store.retailcrm.ru`

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ SSH (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø)

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å SSH –¥–æ—Å—Ç—É–ø –∫ Render.com:

```bash
traceroute -n -m 30 aff-gh.retailcrm.ru
traceroute -n -m 30 slimteapro-store.retailcrm.ru
```

---

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–Ω–ª–∞–π–Ω-—Å–µ—Ä–≤–∏—Å–æ–≤

–ï—Å–ª–∏ traceroute –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ Render.com, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–Ω–ª–∞–π–Ω-—Å–µ—Ä–≤–∏—Å—ã:

1. **https://www.yougetsignal.com/tools/visual-tracert/**
2. **https://www.ultratools.com/tools/traceRoute**
3. **https://www.whatsmydns.net/traceroute**

–ù–æ —ç—Ç–æ –ø–æ–∫–∞–∂–µ—Ç –ø—É—Ç—å –æ—Ç –∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤, –∞ –Ω–µ –æ—Ç –≤–∞—à–µ–≥–æ Render.com —Å–µ—Ä–≤–µ—Ä–∞.

---

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏:

1. **–ù–∞–π—Ç–∏ —É–∑–ª—ã —Å –±–æ–ª—å—à–∏–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏** (>100ms)
2. **–ù–∞–π—Ç–∏ —É–∑–ª—ã —Å –ø–æ—Ç–µ—Ä—è–º–∏ –ø–∞–∫–µ—Ç–æ–≤** (* –∏–ª–∏ timeout)
3. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –≥–¥–µ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞** (–Ω–∞ –∫–∞–∫–æ–º —É–∑–ª–µ)
4. **–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–µ RetailCRM**

---

## –ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏

```
traceroute to aff-gh.retailcrm.ru (185.71.76.XX), 30 hops max, 60 byte packets
 1  10.0.0.1 (10.0.0.1)  0.123 ms  0.098 ms  0.087 ms
 2  172.16.0.1 (172.16.0.1)  1.234 ms  1.198 ms  1.187 ms
 3  203.0.113.1 (203.0.113.1)  5.432 ms  5.398 ms  5.387 ms
 4  * * *  <- –ü—Ä–æ–±–ª–µ–º–∞! –ü–∞–∫–µ—Ç—ã —Ç–µ—Ä—è—é—Ç—Å—è
 5  198.51.100.1 (198.51.100.1)  150.234 ms  150.198 ms  150.187 ms  <- –ë–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞!
 6  185.71.76.XX (185.71.76.XX)  200.123 ms  200.098 ms  200.087 ms
```

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ:
- –£–∑–µ–ª 4 —Ç–µ—Ä—è–µ—Ç –ø–∞–∫–µ—Ç—ã (*)
- –£–∑–µ–ª 5 –∏–º–µ–µ—Ç –±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É (150ms)
- –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—É –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ 3 –∏ 5


